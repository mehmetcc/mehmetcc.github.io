---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { config } from "../../config";
import { Facebook, X as Twitter, Reddit } from "simple-icons-astro";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const canonicalURL = new URL(`/posts/${post.slug}`, config.site.url);
const pubDateISO = post.data.pubDate.toISOString();
---

<Layout
  title={post.data.title}
  description={post.data.description}
  canonicalURL={canonicalURL}
>
  <article class="post">
    <header class="post-header">
      <h1>{post.data.title}</h1>
      <time datetime={pubDateISO}>
        {
          post.data.pubDate.toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })
        }
      </time>
      {post.data.tags && post.data.tags.length > 0 && (
        <div class="post-tags">
          {post.data.tags.map((tag, index) => (
            <>
              <a href={`/categories/${tag}`}>{tag}</a>
              {index < post.data.tags.length - 1 && ' Â· '}
            </>
          ))}
        </div>
      )}
    </header>

    <div class="post-content">
      <Content />
    </div>

    <nav class="post-footer-nav">
      <div class="footer-left">
        <a
          href={`https://www.facebook.com/sharer/sharer.php?u=${canonicalURL}`}
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Share on Facebook"
          class="share-btn"
        >
          <Facebook />
        </a>
        <a
          href={`https://twitter.com/intent/tweet?url=${canonicalURL}&text=${post.data.title}`}
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Share on X"
          class="share-btn"
        >
          <Twitter />
        </a>
        <a
          href={`https://www.reddit.com/submit?url=${canonicalURL}&title=${post.data.title}`}
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Share on Reddit"
          class="share-btn"
        >
          <Reddit />
        </a>
      </div>
      <div class="footer-right">
        <a
          href="/"
          class="return-back-link"
          onclick="event.preventDefault(); history.back();"
          >{config.navigation.returnBack}</a
        >
      </div>
    </nav>
    <script src="https://giscus.app/client.js"
        data-repo="mehmetcc/giscus-discussions"
        data-repo-id="R_kgDOQvQpJA"
        data-category="Announcements"
        data-category-id="DIC_kwDOQvQpJM4C0Qut"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
  </article>
</Layout>

<script
  type="application/ld+json"
  set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    headline: post.data.title,
    description: post.data.description,
    datePublished: pubDateISO,
    dateModified: pubDateISO,
    author: {
      "@type": "Organization",
      name: config.site.title,
    },
    publisher: {
      "@type": "Organization",
      name: config.site.title,
    },
    mainEntityOfPage: {
      "@type": "WebPage",
      "@id": canonicalURL.toString(),
    },
  })}
/>

<style>
  .post {
    margin: 0 auto;
  }

  .post-header {
    margin-bottom: 2.5rem;
    padding-bottom: 2.5rem;
    border-bottom: 1px solid var(--color-gray-medium);
    text-align: center;
  }

  .post-header h1 {
    font-size: 3rem;
    line-height: 1.2;
    margin-bottom: 0.75rem;
  }

  .post-header time {
    display: block;
    color: var(--color-gray-dark);
    font-size: 0.875rem;
    margin-bottom: 0.25rem;
  }

  .post-tags {
    font-size: 0.8em;
    color: #999;
    margin-top: 0;
    text-align: center;
  }

  .post-tags a {
    color: #999;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .post-tags a:hover {
    color: var(--color-black);
  }

  .post-tags span.separator {
    color: #999;
  }

  .post-content :global(a) {
    text-decoration: underline;
    text-decoration-color: var(--color-gray-dark);
    color: var(--color-black);
    transition: color 0.2s ease, text-decoration-color 0.2s ease;
  }

  .post-content :global(a:hover) {
    color: var(--color-gray-dark);
    text-decoration-color: var(--color-black);
  }

  .post-content :global(p) {
    margin-bottom: 1.5rem;
  }

  .post-content :global(h2) {
    margin-top: 3rem;
    margin-bottom: 1.5rem;
  }

  .post-content :global(h3) {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .post-content :global(ul),
  .post-content :global(ol) {
    margin-bottom: 1.5rem;
    padding-left: 2rem;
  }

  .post-content :global(li) {
    margin-bottom: 0.5rem;
  }

  .post-content :global(blockquote) {
    border-left: 3px solid var(--color-gray-medium);
    padding-left: 1.5rem;
    margin: 2rem 0;
    color: var(--color-gray-dark);
    font-style: italic;
  }

  .post-content :global(code) {
    background-color: var(--color-gray-light);
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-size: 0.9em;
  }

  .post-content :global(pre) {
    background-color: var(--color-gray-light);
    padding: 1.5rem;
    border-radius: 3px;
    overflow-x: auto;
    margin: 2rem 0;
  }

  .post-content :global(pre code) {
    background-color: transparent;
    padding: 0;
  }

  .post-footer-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 4rem;
    padding-top: 2rem;
    border-top: 1px solid var(--color-gray-medium);
  }

  .footer-left {
    display: flex;
    gap: 1rem;
  }

  .share-btn svg {
    width: 24px;
    height: 24px;
    fill: currentColor;
    color: black;
    transition: color 0.2s ease;
  }

  .share-btn:hover svg {
    color: #555;
  }

  .footer-right {
  }

  .return-back-link {
    display: inline-block;
    position: relative;
    color: var(--color-black);
    text-decoration: none;
    font-size: 0.875rem;
  }

  .return-back-link::after {
    content: "";
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 1px;
    background-color: var(--color-black);
    transition: width 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .return-back-link:hover::after {
    width: 100%;
  }
</style>